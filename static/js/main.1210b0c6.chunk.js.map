{"version":3,"sources":["compiler/dictionary.js","compiler/compiler.js","mathFieldConfig.js","shader/vertexShader.js","shader/fragmentShader.js","Canvas.js","UndoRedoManager.js","App.js","index.js"],"names":["dict","LatexSyntax","getDictionary","sin","find","name","createEntry","symbol","serialize","trigger","constants","x","y","t","Pi","ExponentialE","compileToGlsl","latex","tokens","parse","replace","preprocess","dictionary","console","log","res","compile","e","token","undefined","Error","Array","isArray","op","slice","map","join","float","num","toString","indexOf","length","mathFieldConfig","autoCommands","autoOperatorNames","vertexShader","fragmentShader","exp","Canvas","expression","canvasRef","useRef","useEffect","canvas","current","gl","getContext","alert","width","clientWidth","height","clientHeight","viewport","window","createShader","VERTEX_SHADER","getVertexShader","FRAGMENT_SHADER","getFragmentShader","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","error","getProgramInfoLog","deleteProgram","useProgram","resolutionUniformLocation","getUniformLocation","uniform2f","mouseUniformLocation","timeUniformLocation","uniform1f","startTime","Date","now","render","drawArrays","TRIANGLE_FAN","requestAnimationFrame","addEventListener","detachShader","deleteShader","StyledCanvas","ref","styled","type","source","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","unaffectingKeys","UndoRedoManager","pMathField","pElement","this","mathField","contentEl","typedHistory","ctrlIsDown","YIsDown","ZIsDown","currentState","buffSize","rearrangeTypedArray","sizeOverflow","isKeyIsUnaffecting","pKey","includes","checkIfSpecialKeysAreUpAndSetStates","pUppedKey","checkIfSpecialKeysAreDownAndSetStates","pDownedKey","saveState","push","undo","redo","which","addStylesMathQuill","latexInit","expInit","MathField","setLatex","setExpression","useState","hasError","setHasError","onChange","a","expressionGlsl","MathFieldDiv","config","style","fontSize","minWidth","maxWidth","margin","textAlign","backgroundColor","mathquillDidMount","el","div","App","ReactDOM","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.1210b0c6.chunk.js","sourcesContent":["import { LatexSyntax } from \"@cortex-js/compute-engine\"\r\n\r\nconst dict = LatexSyntax.getDictionary()\r\nconst sin = LatexSyntax.getDictionary().find(({name}) => name == 'Sin')\r\n\r\nfunction createEntry(symbol) {\r\n    return {\r\n        ...sin,\r\n        name: symbol,\r\n        serialize: symbol,\r\n        trigger: {\r\n            ...sin.trigger,\r\n            symbol\r\n        }\r\n    }\r\n}\r\n\r\nexport default [\r\n    ...dict,\r\n    createEntry('\\\\ln'),\r\n    createEntry('\\\\exp'),\r\n    createEntry('\\\\abs'),\r\n    createEntry('\\\\sign'),\r\n    createEntry('\\\\fract'),\r\n]\r\n","import { parse } from '@cortex-js/compute-engine'\r\nimport dictionary from './dictionary'\r\n\r\nconst constants = {\r\n    x: 'x',\r\n\ty: 'y',\r\n\tt: 't',\r\n\tPi: 'PI',\r\n\tExponentialE: 'E'\r\n}\r\n\r\nconst preprocess = (latex) => latex\r\n    .replace(/\\\\operatorname{abs}/g, '\\\\abs ')\r\n    .replace(/\\\\operatorname{fract}/g, '\\\\fract ')\r\n    .replace(/\\\\operatorname{sign}/g, '\\\\sign ')\r\n\r\nconst compileToGlsl = (latex) => {\r\n    try {\r\n        const tokens = parse(preprocess(latex), {dictionary})\r\n        console.log(tokens)\r\n        const res = compile(tokens)\r\n        console.log(res)\r\n        return res\r\n    }\r\n    catch(e) {\r\n        console.log(e)\r\n    }\r\n}\r\n\r\nconst compile = (token) => {\r\n    if (token === '' || token === null || token === undefined)\r\n        throw new Error('Invalid empty token')\r\n    if (Array.isArray(token)) {\r\n        const op = token[0]\r\n        switch (op) {\r\n            case 'Parentheses':\r\n                return `(${compile(token[1])})`\r\n            case 'Add':\r\n                return `(${token.slice(1).map((t) => compile(t)).join(' + ')})`\r\n            case 'Subtract':\r\n                return `(${compile(token[1])} - ${compile(token[2])})`\r\n            case 'Multiply':\r\n                return `(${token.slice(1).map((t) => compile(t)).join(' * ')})`\r\n            case 'Divide':\r\n                return `(${compile(token[1])} / ${compile(token[2])})`\r\n            case 'Sqrt':\r\n                return `sqrt(${compile(token[1])})`\r\n            case 'Power':\r\n                return `pow(${compile(token[1])}, ${compile(token[2])})`\r\n            case 'Sin':\r\n                return `sin(${compile(token[1])})`\r\n            case 'Cos':\r\n                return `cos(${compile(token[1])})`\r\n            case 'Tan':\r\n                return `tan(${compile(token[1])})`\r\n            case 'Arcsin':\r\n                return `asin(${compile(token[1])})`\r\n            case 'Arccos':\r\n                return `acos(${compile(token[1])})`\r\n            case 'Arctan':\r\n                return `atan(${compile(token[1])})`\r\n            case 'Abs':\r\n                return `abs(${compile(token[1])})`\r\n            case 'Negate':\r\n                return `-(${compile(token[1])})`\r\n            case '\\\\ln':\r\n                return `log(${compile(token[1])})`\r\n            case '\\\\exp':\r\n                return `exp(${compile(token[1])})`\r\n            case '\\\\abs':\r\n                return `abs(${compile(token[1])})`\r\n            case '\\\\sign':\r\n                return `sign(${compile(token[1])})`\r\n            case '\\\\fract':\r\n                return `fract(${compile(token[1])})`\r\n            default:\r\n                throw new Error(`Invalid operation token '${op}'`)\r\n        }\r\n    }\r\n    if (typeof token == 'number')\r\n        return float(token)\r\n    if (typeof token == 'object') \r\n\t\treturn float(token.num)\r\n    if (token in constants)\r\n        return constants[token]\r\n    throw new Error(`Invalid token '${token}'`)\r\n}\r\n\r\nfunction float(num) {\r\n    num = num.toString()\r\n    const i = num.indexOf('.')\r\n    switch(i) {\r\n        case -1:\r\n            return `${num}.0`\r\n        case num.length - 1:\r\n            return `${num}0`\r\n        default:\r\n            return num\r\n    }\r\n}\r\n\r\nexport { compileToGlsl }\r\n","const mathFieldConfig = {\r\n    autoCommands: 'pi sqrt',\r\n    autoOperatorNames: 'sin cos tan arcsin arccos arctan ln exp abs sign fract', // log mod min max\r\n}\r\n\r\nexport default mathFieldConfig","const vertexShader = () => \r\n`#version 300 es\r\n\r\nprecision highp float;\r\n\r\nout vec2 texCoord;\r\n\r\nvoid main(void) {\r\n    vec2 u = vec2(float((gl_VertexID & 1) << 2), float((gl_VertexID & 2) << 1));\r\n    texCoord = u * .5;\r\n    gl_Position = vec4(u - 1.0, 0, 1);\r\n}\r\n`\r\nexport default vertexShader","const fragmentShader = exp => \r\n`#version 300 es\r\n\r\n#define PI 3.1415926535897932384626433832795\r\n#define E 2.718281828459045235360287471352662\r\n\r\nprecision highp float;\r\n\r\nuniform vec2 u_mouse;\r\nuniform vec2 u_resolution;\r\nuniform float u_time;\r\n\r\nin vec2 texCoord;\r\n\r\nout vec4 fragmentColor;\r\n\r\n#define zoom 10.0\r\n#define isMouseEnabled false\r\n\r\nvec3 hsv2rgb(vec3 c)\r\n{\r\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n\r\nfloat f(vec2 p, float t) {\r\n    float x = p.x;\r\n    float y = p.y;\r\n    return ${exp};\r\n}\r\n\r\nvoid main(void) {\r\n    vec2 p = (gl_FragCoord.xy / u_resolution.xy - .5) * zoom;\r\n    vec2 mouse = (u_mouse.xy / u_resolution.xy - .5) * zoom;\r\n    if(!isMouseEnabled)\r\n        mouse = vec2(0.0, 0.0);\r\n    p.x *= 1.0 * u_resolution.x / u_resolution.y;\r\n    mouse.x *= 1.0 * u_resolution.x / u_resolution.y;\r\n    \r\n    vec3 color = vec3(f(p - mouse, u_time), 1.0, 1.0);\r\n    fragmentColor = vec4(hsv2rgb(color), 1.0);\r\n}\r\n`\r\n\r\nexport default fragmentShader","import React, { useEffect, useRef } from 'react'\r\nimport styled from 'styled-components'\r\n\r\nimport getVertexShader from './shader/vertexShader'\r\nimport getFragmentShader from './shader/fragmentShader'\r\n\r\nexport default function Canvas({expression}) {\r\n    const canvasRef = useRef(null)\r\n\r\n    useEffect(() => {\r\n        const canvas = canvasRef.current\r\n        const gl = canvas.getContext(\"webgl2\")\r\n\r\n        if (!gl)\r\n            alert('No WebGL :(')\r\n    \r\n        canvas.width = canvas.clientWidth\r\n        canvas.height = canvas.clientHeight\r\n        gl.viewport(0, 0, gl.canvas.width, gl.canvas.height)\r\n    \r\n        window.vertexShader = createShader(gl, gl.VERTEX_SHADER, getVertexShader())\r\n        window.fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, getFragmentShader(expression))\r\n        window.program = createProgram(gl, window.vertexShader, window.fragmentShader)\r\n    \r\n        gl.useProgram(window.program)\r\n    \r\n        window.resolutionUniformLocation = gl.getUniformLocation(window.program, 'u_resolution')\r\n        gl.uniform2f(window.resolutionUniformLocation, gl.canvas.width, gl.canvas.height)\r\n    \r\n        window.mouseUniformLocation = gl.getUniformLocation(window.program, 'u_mouse')\r\n        gl.uniform2f(window.mouseUniformLocation, 0, 0)\r\n    \r\n        window.timeUniformLocation = gl.getUniformLocation(window.program, 'u_time')\r\n        gl.uniform1f(window.timeUniformLocation, 0)\r\n    \r\n        const startTime = Date.now()\r\n    \r\n        render()\r\n    \r\n        function render() {\r\n            gl.uniform1f(window.timeUniformLocation, (Date.now() - startTime) / 1000)\r\n            gl.drawArrays(gl.TRIANGLE_FAN, 0, 3)\r\n            requestAnimationFrame(render)\r\n        }\r\n    \r\n        window.addEventListener('resize', () => {\r\n            canvas.width = canvas.clientWidth\r\n            canvas.height = canvas.clientHeight\r\n            gl.viewport(0, 0, gl.canvas.width, gl.canvas.height)\r\n            gl.uniform2f(window.resolutionUniformLocation, gl.canvas.width, gl.canvas.height)\r\n        })\r\n    \r\n        window.addEventListener('mousemove', e => { // or touchstart\r\n            gl.uniform2f(window.mouseUniformLocation, e.x, canvas.height - e.y, 1)\r\n        })\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        const canvas = canvasRef.current\r\n        const gl = canvas.getContext(\"webgl2\")\r\n        gl.detachShader(window.program, window.fragmentShader)\r\n        gl.deleteShader(window.fragmentShader)\r\n        window.fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, getFragmentShader(expression))\r\n        gl.attachShader(window.program, window.fragmentShader)\r\n        gl.linkProgram(window.program)\r\n        window.resolutionUniformLocation = gl.getUniformLocation(window.program, 'u_resolution')\r\n        gl.uniform2f(window.resolutionUniformLocation, gl.canvas.width, gl.canvas.height)\r\n\r\n        window.mouseUniformLocation = gl.getUniformLocation(window.program, 'u_mouse')\r\n        gl.uniform2f(window.mouseUniformLocation, 0, 0)\r\n\r\n        window.timeUniformLocation = gl.getUniformLocation(window.program, 'u_time')\r\n        gl.uniform1f(window.timeUniformLocation, 0)\r\n    }, [expression])\r\n\r\n    return <StyledCanvas ref={canvasRef}/>\r\n}\r\n\r\nconst StyledCanvas = styled.canvas`\r\n    width: 100%;\r\n    height: 100%;\r\n    position: absolute;\r\n    z-index: 0;\r\n    background-color: aqua;\r\n`\r\n\r\nfunction createShader(gl, type, source) {\r\n    const shader = gl.createShader(type)\r\n    gl.shaderSource(shader, source)\r\n    gl.compileShader(shader)\r\n    const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS)\r\n    if (success)\r\n        return shader\r\n    console.error(gl.getShaderInfoLog(shader))\r\n    gl.deleteShader(shader)\r\n}\r\n\r\nfunction createProgram(gl, vertexShader, fragmentShader) {\r\n    const program = gl.createProgram()\r\n    gl.attachShader(program, vertexShader)\r\n    gl.attachShader(program, fragmentShader)\r\n    gl.linkProgram(program)\r\n    const success = gl.getProgramParameter(program, gl.LINK_STATUS)\r\n    if (success)\r\n        return program\r\n    console.error(gl.getProgramInfoLog(program))\r\n    gl.deleteProgram(program)\r\n}\r\n","// From https://stackoverflow.com/a/68424478\r\n\r\nconst TAB_KEYCODE = 9;\r\nconst ENTER_KEYCODE = 13;\r\nconst SHIFT_KEYCODE = 16;\r\nconst CTRL_KEYCODE = 17;\r\nconst ALT_KEYCODE = 18;\r\nconst CAPSLOCK_KEYCODE = 20;\r\nconst ESCAPE_KEYCODE = 27;\r\nconst PAGEUP_KEYCODE = 33;\r\nconst PAGEDOWN_KEYCODE = 34;\r\nconst END_KEYCODE = 35;\r\nconst HOME_KEYCODE = 36;\r\nconst LEFTARROW_KEYCODE = 37;\r\nconst UPARROW_KEYCODE = 38;\r\nconst RIGHTARROW_KEYCODE = 39;\r\nconst DOWNARROW_KEYCODE = 40;\r\nconst V_KEYCODE = 86;\r\nconst Y_KEYCODE = 89;\r\nconst Z_KEYCODE = 90;\r\nconst ALTGR_KEYCODE = 225;\r\n\r\nconst unaffectingKeys = [TAB_KEYCODE,\r\n                        ENTER_KEYCODE,\r\n                        SHIFT_KEYCODE,\r\n                        CTRL_KEYCODE,\r\n                        ALT_KEYCODE,\r\n                        CAPSLOCK_KEYCODE,\r\n                        ESCAPE_KEYCODE,\r\n                        LEFTARROW_KEYCODE,\r\n                        PAGEUP_KEYCODE,\r\n                        PAGEDOWN_KEYCODE,\r\n                        END_KEYCODE,\r\n                        HOME_KEYCODE,\r\n                        LEFTARROW_KEYCODE,\r\n                        UPARROW_KEYCODE,\r\n                        RIGHTARROW_KEYCODE,\r\n                        DOWNARROW_KEYCODE,\r\n                        ALTGR_KEYCODE];\r\n\r\nexport default function UndoRedoManager(pMathField, pElement) {\r\n    this.mathField = pMathField;\r\n    this.contentEl = pElement;\r\n    this.typedHistory = [this.mathField.latex()];\r\n    this.ctrlIsDown = false;\r\n    this.YIsDown = false;\r\n    this.ZIsDown = false;\r\n    this.currentState = 0;\r\n    this.buffSize = 50;\r\n\r\n    this.rearrangeTypedArray = () => {\r\n        if (this.typedHistory.length > this.buffSize) {\r\n            let sizeOverflow = this.typedHistory.length - this.buffSize;\r\n            this.currentState = this.currentState - sizeOverflow;\r\n            this.typedHistory = this.typedHistory.slice(this.buffSize * (-1));\r\n        }\r\n    };\r\n\r\n    this.isKeyIsUnaffecting = (pKey) => {\r\n        return unaffectingKeys.includes(pKey);\r\n    };\r\n\r\n    this.checkIfSpecialKeysAreUpAndSetStates = (pUppedKey) => {\r\n        switch (pUppedKey) {\r\n            case CTRL_KEYCODE:\r\n                this.ctrlIsDown = false;\r\n                break;\r\n\r\n            case Y_KEYCODE:\r\n                this.YIsDown = false;\r\n                break;\r\n\r\n            case Z_KEYCODE:\r\n                this.ZIsDown = false;\r\n                break;\r\n        }\r\n    }\r\n\r\n    this.checkIfSpecialKeysAreDownAndSetStates = (pDownedKey) => {\r\n        switch (pDownedKey) {\r\n            case CTRL_KEYCODE:\r\n                this.ctrlIsDown = true;\r\n                break;\r\n\r\n            case Y_KEYCODE:\r\n                this.YIsDown = true;\r\n                break;\r\n\r\n            case Z_KEYCODE:\r\n                this.ZIsDown = true;\r\n                break;\r\n        }\r\n    }\r\n\r\n    this.saveState = () => {\r\n        if (this.currentState !== (this.typedHistory.length - 1)) {\r\n            this.typedHistory = this.typedHistory.slice(0, (this.currentState + 1));\r\n        }   \r\n        \r\n        this.typedHistory.push(this.mathField.latex());\r\n        this.rearrangeTypedArray();\r\n        this.currentState++;\r\n    };\r\n\r\n    this.undo = () => {\r\n        if (this.currentState !== 0) {\r\n            this.currentState--;\r\n            this.mathField.latex(this.typedHistory[this.currentState]);\r\n        }  else {\r\n            //console.log('do nothing');\r\n        }\r\n    };\r\n\r\n    this.redo = () => {\r\n        if (this.currentState < (this.typedHistory.length - 1)) {\r\n            this.currentState++;\r\n            this.mathField.latex(this.typedHistory[this.currentState]);\r\n        } else {\r\n            //console.log('do nothing');\r\n        }\r\n    };\r\n\r\n    this.contentEl.addEventListener('keyup', (e) => {\r\n        this.checkIfSpecialKeysAreUpAndSetStates(e.which);\r\n        \r\n        //log in typedHistory\r\n        if ((this.isKeyIsUnaffecting(e.which) === false)\r\n            && (this.ctrlIsDown === false || (this.ctrlIsDown && e.which === V_KEYCODE))) {\r\n            this.saveState();\r\n        }\r\n    });\r\n\r\n    this.contentEl.addEventListener('keydown', (e) => {\r\n        this.checkIfSpecialKeysAreDownAndSetStates(e.which);\r\n\r\n        //ctrl+z\r\n        if (this.ctrlIsDown && this.ZIsDown) {\r\n            this.undo();\r\n        }\r\n\r\n        //ctrl + y\r\n        if (this.ctrlIsDown && this.YIsDown) {\r\n            this.redo();\r\n        }\r\n    });\r\n}","import React, { useState } from 'react'\r\nimport styled from 'styled-components'\r\nimport { addStyles as addStylesMathQuill, EditableMathField } from 'react-mathquill'\r\nimport { compileToGlsl } from './compiler/compiler'\r\nimport mathFieldConfig from './mathFieldConfig'\r\nimport Canvas from './Canvas'\r\nimport UndoRedoManager from './UndoRedoManager'\r\n\r\naddStylesMathQuill()\r\n\r\nconst latexInit = '\\\\frac{\\\\left(x^2+y^2\\\\right)}{x}-0.7t'\r\nconst expInit = compileToGlsl(latexInit)\r\n\r\nconst MathField = ({setLatex, setExpression, latex, expression}) => {\r\n    const [hasError, setHasError] = useState(false)\r\n    const onChange = async mathField => {\r\n        setLatex(mathField.latex())\r\n        const expressionGlsl = compileToGlsl(mathField.latex())\r\n        if(expressionGlsl)\r\n            setExpression(expressionGlsl)\r\n        setHasError(!expressionGlsl)\r\n    }\r\n    return <>\r\n        <MathFieldDiv>\r\n            <EditableMathField\r\n                latex={latexInit}\r\n                config={mathFieldConfig}\r\n                onChange={onChange}\r\n                style={{\r\n                    fontSize: '20px',\r\n                    minWidth: '200px',\r\n                    maxWidth: '85%',\r\n                    margin: '30px 6px 6px 6px',\r\n                    textAlign: 'center',\r\n                    backgroundColor: hasError ? 'rgba(255, 204, 204, 1)' : 'rgba(255, 255, 255, 0.9)',\r\n                }}\r\n                mathquillDidMount={mathField => new UndoRedoManager(mathField, mathField.el())}\r\n            />\r\n            {/* <p>{latex}</p>\r\n            <p>{expression}</p> */}\r\n        </MathFieldDiv>\r\n    </>\r\n}\r\n\r\nconst MathFieldDiv = styled.div`\r\n    position: relative;\r\n    z-index: 1;\r\n    /* background-color: red; */\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n`\r\n\r\nexport default function App() {\r\n    const [latex, setLatex] = useState(latexInit)\r\n    const [expression, setExpression] = useState(expInit)\r\n    return <>\r\n        <Canvas expression={expression} />\r\n        <MathField latex={latex} setLatex={setLatex} expression={expression} setExpression={setExpression} />\r\n    </>\r\n}\r\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\nimport './index.css'\n\nReactDOM.render(\n    <React.StrictMode>\n        <App />\n    </React.StrictMode>,\n    document.getElementById('root')\n)\n"],"sourceRoot":""}